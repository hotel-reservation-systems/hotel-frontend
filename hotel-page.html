<!DOCTYPE html>
<html lang="en">
<head>
  <title>HOTEL</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"></script>
</head>
<body style="background-color:silver">

  <nav class="navbar navbar-expand-sm bg-dark navbar-dark ">
    <a class="navbar-brand" href="main.html">
      <img src="img/icon.png" alt="logo" style="width:40px;">
    </a>
    <ul class="navbar-nav mr-auto">
      <li class="nav-item" id="signin1">
        <a class="nav-link"  href="signin.html" style="color:silver"  id="signin">Sign in</a>
        <p  class="nav-link" id="welcome"></p>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="register.html" style="color:silver"  id="signup">Register</a>
          <a class="nav-link" id="logout" href="logout.html">logout</a>
      </li>
      <li class="navbar-nav mr-auto">
        <a  class="nav-link" href="map.html">Map</a>
      </li>
        </ul>
        <form class="form-inline">
          <input class="form-control" type="text" placeholder="Search">
          <button class="btn btn-dark btn-outline-dark-grey" type="submit">Search</button>
        </form>
  </nav
  <section class="py-4">
    <div class="container-fluid">
      <h2 class="mb-4">Order status</h2>
      <div class="table-responsive">
        <table class="table">
          <thead>
            <tr><th scope="col">username</th><th scope="col">room_id</th><th scope="col">Order date</th><th scope="col">due date</th><th class="text-center" scope="col">Status</th><th class="text-center" scope="col">order time</th></tr>
          </thead>
          <tbody id="list">
          </tbody>
        </table>
      </div>
    </div>
  </section>

  <section class="py-5" >
  <div class="container text-center" >
    <h2 class="mb-4">HOTEL</h2>
    <div class="border rounded px-3" id="test">
      </div>
    </div>
  </div>
</section>
</body>
<script>

  function makelist(hotel_id,rate,price){
    $('#test').append('<div class="row">');
    $('#test').append('<h3 class="mb-3">'+rate+'</h3>');
    $('#test').append('<p>'+price+'<small class="text-muted"> Per user / day</small></p>');
    $('#test').append('<p class="lead"> A room with a'+rate+' bed. </p>');
    $('#test').append('<ul class="list-unstyled mt-3 mb-4">');
    $('#test').append('<li>free wifi</li>');
    $('#test').append('<li>free charge</li>');
    $('#test').append('<li>free coffee</li>');
    $('#test').append('</ul>');
    $('#test').append('<button class="btn btn-lg btn-outline-primary" type="button">BOOK</button></div>');
    $('#test').append('<hr class="d-none d-md-block">');

  }
  $(document).ready(function(){
    $.ajax({
      url:'https://venus.cs.qc.cuny.edu/~lemi2837/cs370/project2/backend/auth/status/',
      type:'POST',
      success:function(response){

        var logout=document.getElementById("logout");
        if(response.data["loggedin"]==true){
            document.getElementById("signin").style.display="none";
            document.getElementById("signup").style.display="none";
            document.getElementById("welcome").innerHTML=response.data["username"];
            logout.style.display="block";
        }else{
            document.getElementById("signin").style.display="block";
            document.getElementById("signup").style.display="block";
            document.getElementById("welcome").innerHTML="";
            logout.style.display="none";

        }
      }
    });
  });
  function makebookedlist(user_id,room_id,date_from,date_to,order_time){
  $('#list').append('<tr><td>'+user_id+'</td>');
  $('#list').append('<td>'+room_id+'</td>');
  $('#list').append('<td>'+date_from+'</td>');
  $('#list').append('<td>'+date_to+'</td>');
  $('#list').append('<td class="text-center"><span class="badge badge-success">'+booked+'</span></td>');
  $('#list').append('<td class="text-center">'+order_time+'</td></tr');
  }
  $(document).ready(function(){
    var username=$("#welcome").text();
    $.ajax({
      url:'https://venus.cs.qc.cuny.edu/~lemi2837/cs370/project2/backend/reservation/list/',
      type:'POST',
      success:function(response){
        $.each(response,function(key,value){
          if(key=="data"){
            console.log(value);
            $.each(value,function(key1,value1){
              var user_id,room_id,date_from,date_to,order_time;
              $.each(value1,function(key2,value2){
                if(key2=="user_id") user_id=value2;
                if(user_id==username){
                    if(key2=="room_id") room_id=value2;
                    if(key2=="date_from") date_from=value2;
                    if(key2=="date_to") date_to=value2;
                    if(key2=="created"){
                      order_time=vaue2;
                      console.log(user_id+" "+room_id+" "+date_from+" "+date_to+" "+order_time);
                      makebookedlist(user_id,room_id,date_from,date_to,order_time);
                    }
                }

              });
            });
          }
        });
      }
    });
  });
  $(document).ready(function(){
	var u=location.href;
	var n=u.indexOf("?");
	var str=u.substr(n+1);
		$.ajax({
			url:'https://venus.cs.qc.cuny.edu/~lemi2837/cs370/project2/backend/room/list/?hotel_id='+str,
			type:'POST',
			success:function(response){
			$.each(response,function(key,value ){
				if(key=="data"){
					console.log(value);
					$.each(value,function(key1,value1){
						var hotel_id,rate,price;
						$.each(value1,function(key2,value2){
                  if(key2=="hotel_id") hotel_id=value2;
                  if(key2=="rate") rate=value2;
                  if(key2=="price"){ price=value2;
                  console.log(hotel_id+" "+rate+" "+price);
                  makelist(hotel_id,rate,price);
							 }
						});

					});
				}
			});
// 			}
		}
	});
	});
</script>
</html>
